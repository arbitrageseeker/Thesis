---
output:
  md_document:
    variant: markdown
mainfont: Times New Roman
bibliography: Bibliography.bib
biblio-style: chicagoa
link-citations: yes
fontsize: 12pt
geometry: [top=3cm, bottom=2.5cm, right=2.5cm, left=3cm]
header-includes:
- \usepackage{setspace}
- \doublespacing
- \usepackage{dcolumn}
- \usepackage{amsmath,amsthm}
- \usepackage{rotating}
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage{xcolor}
- \usepackage{caption}
- \usepackage{tabularx}
- \usepackage{hhline}
- \usepackage{fixltx2e}
- \usepackage{hyperref}
- \usepackage{tocloft}
---

\clearpage

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE)

```



\section{Appendix}\label{appendix}

\scriptsize
  \begin{longtable}{lp{10cm}l}
  \captionsetup{justification=raggedright,
                           width=1.02\linewidth,
                           singlelinecheck=off}
    \caption[Variables and Definitions]{\textbf{Variables and Definitions}\newline\footnotesize This table reports the variables used in the study, their definitions and data sources.}\label{table_variable_definitions} \\
      \toprule
      Variable & Definition & Source \\
      \midrule
      \multicolumn{3}{l}{\textit{Panel A: Ownership variables}} \\
      \addlinespace
     \textit{FOR\_OWN} & Number of a firm's shares held by foreign institutions divided by the firm’s total shares outstanding (CRSP) at the end of a quarter. & 13F and CRSP \\
     \addlinespace
      \textit{FOR\_BREADTH} & Number of a firm’s distinct foreign institutional shareholders divided by the total number of distinct institutional shareholders in 13F database at the end of a quarter. & 13F \\
      \addlinespace
      \textit{INST\_OWN} & Number of a firm's shares held by total institutions divided by the firm’s total shares outstanding (CRSP) at the end of a quarter. & 13F and CRSP \\
      \addlinespace
      \textit{INST\_BREADTH} & Number of a firm's distinct institutional shareholders divided by the total number of distinct institutional shareholders in 13F database at the end of a quarter. & 13F \\
      \addlinespace
      \textit{FOR\_TO\_INST\_OWN} & Number of firm’s shares held by foreign institutions divided by the firm’s shares held by total institutions at the end of a quarter. & 13F \\
      \addlinespace
      \textit{FOR\_TO\_INST\_BREADTH} & Number of a firm's distinct foreign institutional shareholders divided by the number of firm’s distinct total institutions at the end of a quarter. & 13F \\
      \addlinespace
      \midrule
      \multicolumn{3}{l}{\textit{Panel B: Control variables}} \\
      \addlinespace
      \textit{LOG\_MKT\_CAP} & Logarithm of a firm's market capitalization calculated as market price multiplied by shares outstanding at the end of a quarter. & CRSP \\
      \addlinespace
      \textit{BM\_RATIO} & Firm's book value of equity divided by market capitalization at the end of a quarter. & COMPUSTAT \\
      \addlinespace
      \textit{LEVERAGE} & Firm's total debt divided by total assets at the end of a quarter. & COMPUSTAT \\
      \addlinespace
      \textit{ROA} & Firm's net income divided by total assets at the end of a quarter. & COMPUSTAT \\
      \addlinespace
      \midrule
      \multicolumn{3}{l}{\textit{Panel C: Information asymmetry variables}} \\
      \addlinespace
      \textit{BA\_SPREAD} & annual average of firm-day observations of bid-ask spreads $\dfrac{\text{\textit{ask\textsubscript{i,t}}\textminus \textit{bid\textsubscript{i,t}}}}{\text{\textit{price\textsubscript{i,t}}}}$. & CRSP \\
      \addlinespace
      \textit{PIN\textsubscript{BHL}} & Firm-year observations of probability of informed trading estimated by Brown et al (2004). & author's website \protect\footnotemark \\
       \footnotetext{Firm-year observations of
  \emph{PIN\textsubscript{BHL}}, \emph{PIN\textsubscript{BH}},
  \emph{PIN\textsubscript{DY}}, \emph{PIN\textsubscript{DY\_ADJ}},
  \emph{PSOS\textsubscript{DY}} and \emph{PIN\textsubscript{EHO}} are
  made available by Stephen Brown
  (\url{http://scholar.rhsmith.umd.edu/sbrown/pin-data}), Jefferson
  Duarte (\url{http://www.owlnet.rice.edu/~jd10/}) and Søren Hvidkjær
  (\url{https://sites.google.com/site/hvidkjaer/data}), respectively.
  Daily firm-level observations of \emph{MIA} are made available by
  Travis Johnson (\url{http://travislakejohnson.com/data.html}).} \\
      \addlinespace
      \textit{PIN\textsubscript{BH}} & Firm-year observations of probability of informed trading estimated by Brown and Hillegeist (2007). & author's website \\
      \addlinespace
      \textit{PIN\textsubscript{DY}} & Firm-year observations of probability of informed trading estimated by Duarte and Young (2009). & author's website \\
      \addlinespace
      \textit{PIN\textsubscript{DY\_ADJ}} & Firm-year observations of probability of informed trading cleaned of illiquidity effects estimated by Duarte and Young (2009). & author's website \\
      \addlinespace
      \textit{PSOS\textsubscript{DY}} & Firm-year observations of probability of symmetric order-flow shock (illiquidity measure) estimated by Duarte and Young (2009). & author's website \\
      \addlinespace
      \textit{PIN\textsubscript{EHO}} & Firm-year observations of probability of informed trading estimated by Easley et al. (2010). & author's website \\
      \addlinespace
      \textit{MIA} & Annual average of firm-day observations of multimarket information asymmetry measure estimated by Johnson and So (2017). & author's website \\
      \addlinespace
      \textit{VCV\textsubscript{USD}} & Fraction of the annual standard deviation of firm-day trading volumes divided by the annual average of firm-day trading volumes. Trading volume is in US dollars. It is defined as a firm's shares traded multiplied by the firm's closing price. & CRSP \\
      \addlinespace
      \textit{VCV\textsubscript{MKT}} & Fraction of the annual standard deviation of firm-day trading volumes divided by the annual average of firm-day trading volumes. Trading volume is a percentage of total market volume. It is defined as a firm's shares traded multiplied by the firm's closing price divided by total sum of trading volumes on the same day. & CRSP \\
      \addlinespace
      \textit{VCV\textsubscript{TO}} & Fraction of the annual standard deviation of firm-day trading volumes divided by the annual average of firm-day trading volumes. Trading volume is a daily turnover. It is defined as a firm's shares traded divided by the firm's shares outstanding. & CRSP \\
      \addlinespace
      \midrule
      \multicolumn{3}{l}{\textit{Panel D: Variables of quasi-natural experiment}} \\
      \addlinespace
      \textit{AFTER} & Dummy variable which equals one for firm-day observations that occur after brokerage closures and zero otherwise. & IBES \\
      \addlinespace
      \textit{TREATED} & Dummy variable which equals one for firm-day observations if a firm is affected by the exogenous reduction in analyst coverage due to brokerage closures and zero otherwise. & IBES \\
      \addlinespace
      \textit{AFTER\texttimes TREATED} & Interaction term of the variables \textit{AFTER} and \textit{TREATED}. & IBES \\
      \addlinespace
      \textit{ANALYST\_COVERAGE} & Number of distinct analysts covering a firm in a given quarter. & IBES \\
      \bottomrule
  \end{longtable}
  
``` {r parallel_trend1_facet, message = FALSE, warning=FALSE, eval=FALSE}

library(tidyverse)
library(lubridate)

Sys.setlocale("LC_TIME", "English")

parallel_trend1_facet <- read_rds("results/did_regression_matched_raw.rds") %>% 
  mutate(TREATED = if_else(TREATED == 1, "Treated", "Control")) %>% 
  group_by(event_date, brokerage_name) %>% 
  mutate(sample = n()) %>% 
  mutate(event_abbr = format(event_date, format = "%Y-%b")) %>% 
  ungroup() %>% 
  mutate(facet_column = paste(event_abbr, " ", brokerage_name, ": N=", sample)) %>% 
  group_by(TREATED, quarter_index, facet_column) %>% 
  summarise(FOR_OWN = mean(FOR_OWN),
            FOR_BREADTH = mean(FOR_BREADTH)) %>% 
  ungroup()

ggplot(parallel_trend1_facet, aes(quarter_index, FOR_OWN, color = TREATED)) +
  ggtitle("") +
  geom_line() +
  labs(x = "Event quarter", color = "") +
  geom_vline(xintercept=0) +
  theme_classic() +
  theme(plot.title = element_text(size=9, face="italic")) +
  scale_color_grey(start = 0.55, end = 0) +
  facet_wrap(. ~ facet_column, ncol = 4) +
  theme(strip.text = element_text(size=4))

ggsave("figures/parallel_trend1a_facet.pdf", 
       width = 8, height = 8, units = "in")
  
```

\begin{figure}[H]
\centering
\includegraphics[width = \linewidth]{figures/parallel_trend1a_facet.pdf}
\caption[Foreign ownership between the treatment and control groups around each brokerage closure]{\textbf{Foreign ownership between the treatment and control groups around each brokerage closure}\newline\scriptsize This figure presents the evolution of the mean of firm-quarter observations of foreign ownership (\textit{FOR\_OWN}) around each brokerage closure. I impose a three-month gap over the events so that foreign ownership estimates are from quarters [-12,-1] and [1,12], with the brokerage closure occurring in the quarter 0. Control firms are matched using propensity score matching (nearest neighbor) that matches each treatment firm to three control firms by multiple covariates (twelve quarters before the event): logarithm of market capitalization (\textit{LOG\_MKT\_CAP}), book-to-market ratio (\textit{BM\_RATIO}) and number of distinct analysts covering the firm (\textit{ANALYST\_COVERAGE}). The firm-quarter observations of foreign ownership are winsorized at the top and bottom 1\%. Sample period: 1997- 2010. Sources: CRSP, COMPUSTAT, 13F and IBES.}
\label{fig_parallel_trend1_facet}
\end{figure}


``` {r parallel_trend1, message = FALSE, warning=FALSE, eval=FALSE}

library(tidyverse)

parallel_trend1 <- read_rds("results/did_regression_matched_raw.rds") %>% 
  mutate(TREATED = if_else(TREATED == 1, "Treated", "Control")) %>% 
  group_by(TREATED, quarter_index) %>% 
  summarise(LOG_ANALYST_COVERAGE = mean(log(1+ANALYST_COVERAGE)),
            ANALYST_COVERAGE = mean(ANALYST_COVERAGE)) %>% 
  ungroup()

ggplot(parallel_trend1, aes(quarter_index, LOG_ANALYST_COVERAGE, color = TREATED)) +
  ggtitle("Panel A: Logarithm of analyst coverage") +
  geom_line() +
  labs(x = "Event quarter", color = "") +
  geom_vline(xintercept=0) +
  theme_classic() +
  theme(plot.title = element_text(size=9, face="italic")) +
  scale_color_grey(start = 0.55, end = 0)

ggsave("figures/parallel_trend_analyst_a.pdf", 
       width = 8, height = 6, units = "in")

ggplot(parallel_trend1, aes(quarter_index, ANALYST_COVERAGE, color = TREATED)) +
  ggtitle("") +
  geom_line() +
  labs(x = "Event quarter", color = "") +
  geom_vline(xintercept=0) +
  theme_classic() +
  theme(plot.title = element_text(size=9, face="italic")) +
  scale_color_grey(start = 0.55, end = 0)

ggsave("figures/parallel_trend_analyst_b.pdf", 
       width = 8, height = 6, units = "in")
  
```

\clearpage

\begin{figure}[H]
\centering
\includegraphics[width = \linewidth]{figures/parallel_trend_analyst_b.pdf}
\caption[Analyst coverage between the treatment and control groups around brokerage closures]{\textbf{Analyst coverage between the treatment and control groups during brokerage closures}\newline\scriptsize This figure presents the evolution of the mean of firm-quarter observations of analyst coverage (\textit{ANALYST\_COVERAGE}) during the twelve quarters (i.e. three years) before and after an exogenous decrease in analyst coverage due to the 22 distinct brokerage closures listed by Kelly and Ljungqvist (2012). I impose a three-month gap over the events so that foreign ownership estimates are from quarters [-12,-1] and [1,12], with the brokerage closure occurring in the quarter 0. Control firms are matched using propensity score matching (nearest neighbor) that matches each treatment firm to three control firms by multiple covariates (twelve quarters before the event): logarithm of market capitalization (\textit{LOG\_MKT\_CAP}), book-to-market ratio (\textit{BM\_RATIO}) and number of distinct analysts covering the firm (\textit{ANALYST\_COVERAGE}). The firm-quarter observations of foreign ownership and foreign breadth are winsorized at the top and bottom 1\%. Sample period: 1997- 2010. Sources: CRSP, COMPUSTAT, 13F and IBES.}
\label{fig_parallel_trend_analyst}
\end{figure}

\clearpage

``` {r, results='asis', message = FALSE, warning=FALSE, eval=FALSE}

library(tidyverse)
library(lubridate)
library(lfe)
library(stargazer)

did_regression_nonmatched1 <- read_rds("results/did_regression_nonmatched1.rds") %>%
  mutate(AFTER_TREATED = TREATED * AFTER,
         sic_code = str_sub(sic_code, 1, 3))


did_model1 <- felm(FOR_OWN ~ AFTER + TREATED + AFTER_TREATED + LOG_MKT_CAP + BM_RATIO +
                     LEVERAGE + ROA|year + sic_code|0|year + sic_code,
                   data = did_regression_nonmatched1)

did_model2 <- felm(FOR_BREADTH ~ AFTER + TREATED + AFTER_TREATED + LOG_MKT_CAP + BM_RATIO +
                     LEVERAGE + ROA|year + sic_code|0|year + sic_code,
                   data = did_regression_nonmatched1)

did_model3 <- felm(FOR_TO_INST_OWN ~ AFTER + TREATED + AFTER_TREATED + LOG_MKT_CAP + BM_RATIO +
                     LEVERAGE + ROA|year + sic_code|0|year + sic_code,
                   data = did_regression_nonmatched1)

did_model4 <- felm(FOR_TO_INST_BREADTH ~ AFTER + TREATED + AFTER_TREATED + LOG_MKT_CAP + BM_RATIO +
                     LEVERAGE + ROA|year + sic_code|0|year + sic_code,
                   data = did_regression_nonmatched1)

did_list <- list(did_model1, did_model2, did_model3, did_model4)

treated_obs <- did_regression_nonmatched1 %>% filter(TREATED == 1) %>% 
  group_by(TREATED) %>% summarise(n = n()) %>% ungroup() %>% pluck("n") %>% 
  format(big.mark = ",")

control_obs <- did_regression_nonmatched1 %>% filter(TREATED == 0) %>% 
  group_by(TREATED) %>% summarise(n = n()) %>% ungroup() %>% pluck("n") %>% 
  format(big.mark = ",")

treated_distinct <- did_regression_nonmatched1 %>% filter(TREATED == 1) %>% 
  group_by(TREATED) %>% summarise(n = n_distinct(permno)) %>% ungroup() %>% pluck("n") %>% 
  format(big.mark = ",")

control_distinct <- did_regression_nonmatched1 %>% filter(TREATED == 0) %>% 
  group_by(TREATED) %>% summarise(n = n_distinct(permno)) %>% ungroup() %>% pluck("n") %>%
  format(big.mark = ",")

obs <- did_regression_nonmatched1 %>%
  summarise(n = n()) %>% ungroup() %>% pluck("n") %>% 
  format(big.mark = ",")

stargazer(did_list, title = "\\textbf{Difference-in-differences regression analysis of foreign ownership and breadth}\\newline\\small This table reports the results of the difference-in-differences regression analysis of foreign ownership and breadth. The explanatory variables are \\textit{AFTER}.",
          label = "table_h2_1",
          header = F,
          dep.var.labels =c("FOR\\_OWN", "FOR\\_BREADTH"),
          #column.labels = rep(c("[-1,1] years", "[-2,2] years", "[-3,3] years"), times = 2),
          covariate.labels = c("AFTER", "TREATED", "AFTER\\texttimes TREATED", "LOG\\_MKT\\_CAP", "BM\\_RATIO", "LEVERAGE", "ROA"),
          omit.stat = c("ser", "rsq", "n"),
          add.lines = list(c("Industry fixed effects", rep("Yes", times = 4)),
                           c("Year fixed effects", rep("Yes", times = 4)),
                           c("Treated firm obs.", rep(treated_obs, times = 4)),
                           c("Control firm obs.", rep(control_obs, times = 4)),
                           c("Distinct treated firms", rep(treated_distinct, times = 4)),
                           c("Distinct control firms", rep(control_distinct, times = 4)),
                           c("Observations", rep(obs, times = 4))),
          type = 'latex',
          notes.label = "",
          notes.append = F,
          notes = "",
          font.size = "small",
          no.space = T)

```


\renewcommand\arraystretch{0.90}
\captionsetup{width=1.0\linewidth}
  \footnotesize
\begin{longtable}{@{\extracolsep{0pt}}lcccc}
  \caption[Difference-in-differences regression analysis of foreign ownership-specific variables without control group matching]{\textbf{Difference-in-differences regression analysis of foreign ownership-specific variables without control group matching}\newline\scriptsize This table reports the results of the difference-in-differences regression analysis of ownership-specific variables without control group matching. The treatment group is determined as stocks that lose a covering analyst due to 22 distinct brokerage closures listed by Kelly and Ljungqvist (2012). For all stocks, I compute averages of the dependent variables and control variables in all columns over the quarters [-4,-1] and over the quarters [1,4], with the brokerage closure occurring in quarter 0. The explanatory variables are dummy variables indicating the treatment group (\textit{TREATED}), the post-event period (\textit{AFTER}) and their interaction (\textit{AFTER}\texttimes\textit{TREATED}). The control variables are book-to-market ratio (\textit{BM\_RATIO}), leverage (\textit{LEVERAGE}) and return on assets (\textit{ROA}). I include industry and year fixed effects in all regressions. Standard errors are clustered by the industry and year level and reported in parentheses. \textit{FOR\_OWN} and \textit{FOR\_BREADTH} are winsorized at the top to a maximum of 1. Control variables are winsorized at the top and bottom 1\%. Table \ref{table_variable_definitions} in Appendix provides a detailed list of variable definitions. *, ** and *** denote the statistical significance at the 10\%, 5\% and 1\% level, respectively. Sample period: 1997-2010. Sources: CRSP, COMPUSTAT, 13F and IBES.} 
  \label{table_h2_nonmatched} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{4}{c}{\textit{Dependent variable:}} \\ 
\cline{2-5} 
\\[-1.8ex] & FOR\_OWN & FOR\_BREADTH & FOR\_TO\_INST\_OWN & FOR\_TO\_INST\_BREADTH \\ 
\\[-1.8ex] & (1) & (2) & (3) & (4)\\ 
\hline \\[-1.8ex] 
 AFTER & 0.007$^{***}$ & 0.0003$^{***}$ & 0.004 & 0.002 \\ 
  & (0.002) & (0.0001) & (0.003) & (0.005) \\ 
  TREATED & 0.0005 & 0.001$^{**}$ & $-$0.005$^{***}$ & $-$0.002 \\ 
  & (0.001) & (0.0004) & (0.001) & (0.002) \\ 
  AFTER\texttimes TREATED & 0.001 & 0.0001 & 0.003 & 0.004 \\ 
  & (0.001) & (0.0002) & (0.002) & (0.002) \\ 
  LOG\_MKT\_CAP & 0.006$^{***}$ & 0.002$^{***}$ & 0.005$^{***}$ & 0.0002 \\ 
  & (0.001) & (0.0002) & (0.001) & (0.002) \\ 
  BM\_RATIO & 0.0004 & 0.001$^{***}$ & $-$0.004$^{*}$ & 0.001 \\ 
  & (0.002) & (0.0002) & (0.002) & (0.002) \\ 
  LEVERAGE & 0.003 & 0.002$^{***}$ & $-$0.012$^{***}$ & $-$0.001 \\ 
  & (0.002) & (0.0003) & (0.004) & (0.003) \\ 
  ROA & 0.054$^{***}$ & $-$0.005$^{***}$ & $-$0.067$^{***}$ & $-$0.049$^{***}$ \\ 
  & (0.008) & (0.002) & (0.019) & (0.019) \\ 
 \hline \\[-1.8ex] 
Industry fixed effects & Yes & Yes & Yes & Yes \\ 
Year fixed effects & Yes & Yes & Yes & Yes \\ 
Treated firm obs. & 5,424 & 5,424 & 5,424 & 5,424 \\ 
Control firm obs. & 152,298 & 152,298 & 152,298 & 152,298 \\ 
Distinct treated firms & 1,651 & 1,651 & 1,651 & 1,651 \\ 
Distinct control firms & 6,717 & 6,717 & 6,717 & 6,717 \\
Observations & 157,722 & 157,722 & 157,722 & 157,722 \\ 
Adjusted R$^{2}$ & 0.189 & 0.678 & 0.111 & 0.098 \\ 
\hline 
\hline \\[-1.8ex] 
\multicolumn{5}{r}{} \\ 
\end{longtable}

         
         
``` {r, results='asis', message = FALSE, warning=FALSE, eval=FALSE}

library(tidyverse)
library(lubridate)
library(lfe)
library(stargazer)
library(AER)

did_regression_matched1_iv <- read_rds("results/did_regression_matched1_iv.rds") %>% 
    mutate(AFTER_TREATED = AFTER*TREATED,
         sic_code = str_sub(sic_code, 1, 4)) %>% 
  rename(VCV_USD = vcv1, VCV_MKT = vcv2, VCV_TO = vcv3, BA_SPREAD = bid_ask_spread)

did_model1 <- felm(VCV_USD ~ AFTER + TREATED + AFTER_TREATED + BM_RATIO + LEVERAGE + ROA|
                     year + sic_code | 0 | year + sic_code,
                   data = did_regression_matched1_iv)

did_model_f <- felm(FOR_OWN ~ BM_RATIO + LEVERAGE + ROA |
                     year + sic_code|
                     (VCV_USD ~ TREATED + AFTER + AFTER_TREATED)|
                     year + sic_code,
                     data = did_regression_matched1_iv)

test <- lfe::waldtest(did_model_f$stage1, ~TREATED|AFTER|AFTER_TREATED, type = "cluster")

did_model2 <- felm(FOR_OWN ~ VCV_USD + BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     0 |
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model3 <- felm(FOR_OWN ~ BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     (VCV_USD ~  AFTER + TREATED + AFTER_TREATED) |
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model4 <- felm(FOR_BREADTH ~ VCV_USD + BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     0 |
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model5 <- felm(FOR_BREADTH ~ BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     (VCV_USD ~ AFTER + TREATED + AFTER_TREATED) |
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model6 <- felm(FOR_TO_INST_OWN ~ VCV_USD + BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     0 |
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model7 <- felm(FOR_TO_INST_OWN ~ BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     (VCV_USD ~ AFTER + TREATED + AFTER_TREATED) |
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model8 <- felm(FOR_TO_INST_BREADTH ~ VCV_USD + BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     0 |
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model9 <- felm(FOR_TO_INST_BREADTH ~ BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     (VCV_USD ~ AFTER + TREATED + AFTER_TREATED) |
                     year + sic_code,
                   data = did_regression_matched1_iv)


did_list <- list(did_model1, did_model2, did_model3, did_model4, did_model5,
                 did_model6, did_model7, did_model8, did_model9)

treated_obs <- did_regression_matched1_iv %>% filter(TREATED == 1) %>% 
  group_by(TREATED) %>% summarise(n = n()) %>% ungroup() %>% pluck("n") %>% 
  format(big.mark = ",")

control_obs <- did_regression_matched1_iv %>% filter(TREATED == 0) %>% 
  group_by(TREATED) %>% summarise(n = n()) %>% ungroup() %>% pluck("n") %>% 
  format(big.mark = ",")

treated_distinct <- did_regression_matched1_iv %>% filter(TREATED == 1) %>% 
  group_by(TREATED) %>% summarise(n = n_distinct(permno)) %>% ungroup() %>% pluck("n") %>% 
  format(big.mark = ",")

control_distinct <- did_regression_matched1_iv %>% filter(TREATED == 0) %>% 
  group_by(TREATED) %>% summarise(n = n_distinct(permno)) %>% ungroup() %>% pluck("n") %>%
  format(big.mark = ",")

obs <- did_regression_matched1_iv %>%
  summarise(n = n()) %>% ungroup() %>% pluck("n") %>% 
  format(big.mark = ",")

stargazer(did_list, title = "\\textbf{Difference-in-differences regression analysis of foreign ownership and breadth}\\newline\\footnotesize This table reports the results of the difference-in-differences regression analysis of foreign ownership and breadth. The explanatory variables are \\textit{AFTER}.",
          label = "table_h2_1",
          header = F,
          #dep.var.labels =c("FOR\\_OWN", "FOR\\_BREADTH"),
          #column.labels = rep(c("[-1,1] years", "[-2,2] years", "[-3,3] years"), times = 2),
          omit.stat = c("ser", "rsq", "n"),
          add.lines = list(c("Industry fixed effects", rep("Yes", times = 9)),
                           c("Year fixed effects", rep("Yes", times = 9)),
                           c("Treated firm obs.", rep(treated_obs, times = 9)),
                           c("Control firm obs.", rep(control_obs, times = 9)),
                           c("Distinct treated firms", rep(treated_distinct, times = 9)),
                           c("Distinct control firms", rep(control_distinct, times = 9)),
                           c("Observations", rep(obs, times = 9))),
          type = 'latex',
          notes.label = "",
          notes.append = F,
          notes = "",
          font.size = "footnotesize",
          no.space = T)

did_model1 <- felm(BA_SPREAD ~ AFTER + TREATED + AFTER_TREATED + BM_RATIO +
                     LEVERAGE + ROA | year + sic_code | 0 | year + sic_code,
                   data = did_regression_matched1_iv)

did_model_f <- felm(FOR_OWN ~ BM_RATIO + LEVERAGE + ROA |
                     year + sic_code|
                     (BA_SPREAD ~ TREATED + AFTER + AFTER_TREATED)|
                     year + sic_code,
                     data = did_regression_matched1_iv)

test <- lfe::waldtest(did_model_f$stage1, ~TREATED|AFTER|AFTER_TREATED, type = "cluster")

did_model2 <- felm(FOR_OWN ~ BA_SPREAD + BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     0|
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model3 <- felm(FOR_OWN ~ BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     (BA_SPREAD ~ AFTER + TREATED + AFTER_TREATED) |
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model4 <- felm(FOR_BREADTH ~ BA_SPREAD + BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     0|
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model5 <- felm(FOR_BREADTH ~ BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     (BA_SPREAD ~ AFTER + TREATED + AFTER_TREATED ) |
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model6 <- felm(FOR_TO_INST_OWN ~ BA_SPREAD + BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     0|
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model7 <- felm(FOR_TO_INST_OWN ~ BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     (BA_SPREAD ~ AFTER + TREATED + AFTER_TREATED ) |
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model8 <- felm(FOR_TO_INST_BREADTH ~ BA_SPREAD + BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     0|
                     year + sic_code,
                   data = did_regression_matched1_iv)

did_model9 <- felm(FOR_TO_INST_BREADTH ~ BM_RATIO + LEVERAGE + ROA|
                     year + sic_code|
                     (BA_SPREAD ~ AFTER + TREATED + AFTER_TREATED ) |
                     year + sic_code,
                   data = did_regression_matched1_iv)


did_list <- list(did_model1, did_model2, did_model3, did_model4, did_model5,
                 did_model6, did_model7, did_model8, did_model9)

stargazer(did_list, title = "\\textbf{Difference-in-differences regression analysis of foreign ownership and breadth}\\newline\\footnotesize This table reports the results of the difference-in-differences regression analysis of foreign ownership and breadth. The explanatory variables are \\textit{AFTER}.",
          label = "table_h2_1",
          header = F,
          #dep.var.labels =c("FOR\\_OWN", "FOR\\_BREADTH"),
          #column.labels = rep(c("[-1,1] years", "[-2,2] years", "[-3,3] years"), times = 2),
          omit.stat = c("ser", "rsq", "n"),
          add.lines = list(c("Industry fixed effects", rep("Yes", times = 9)),
                           c("Year fixed effects", rep("Yes", times = 9)),
                           c("Treated firm obs.", rep(treated_obs, times = 9)),
                           c("Control firm obs.", rep(control_obs, times = 9)),
                           c("Distinct treated firms", rep(treated_distinct, times = 9)),
                           c("Distinct control firms", rep(control_distinct, times = 9)),
                           c("Observations", rep(obs, times = 9))),
          type = 'latex',
          notes.label = "",
          notes.append = F,
          notes = "",
          font.size = "footnotesize",
          no.space = T)


```

\clearpage

\renewcommand\arraystretch{0.63}
\begin{landscape}
\captionsetup{width=0.99\linewidth}
\footnotesize
\begin{longtable}{@{\extracolsep{12pt}}lccccccccc}
  \caption[Difference-in-differences regression analysis of foreign ownership-specific variables with instrumental variable approach]{\textbf{Difference-in-differences regression analysis of foreign ownership-specific variables with instrumental variable approach}\newline\scriptsize This table reports the results of the difference-in-differences regression analysis of foreign ownership-specific variables with instrumental variable approach. The treatment group is determined as stocks that lose a covering analyst due to 22 distinct brokerage closures listed by Kelly and Ljungqvist (2012). For all stocks, I compute averages of the dependent variables and control variables in all columns over the quarters [-4,-1] and over the quarters [1,4], with the brokerage closure occurring in quarter 0. In the first-stage regression, explanatory variables are dummy variables indicating the treatment group (\textit{TREATED}), the post-event period (\textit{AFTER}) and their interaction (\textit{AFTER}\texttimes\textit{TREATED}). The control variables are book-to-market ratio (\textit{BM\_RATIO}), leverage (\textit{LEVERAGE}) and return on assets (\textit{ROA}). In the second-stage instrumental variable regressions, fitted values of information asymmetry measure are used as explanatory variable along with the control variables. I also examine the OLS panel regressions with information asymmetry measure (non-fitted) as explanatory variable along with control variables. I include industry and year fixed effects in all regressions. Standard errors are clustered by the industry and year level and reported in parentheses. I test the weakness of instruments by examining their joint significance and report the first-stage F-statistics. \textit{FOR\_OWN} and \textit{FOR\_BREADTH} are winsorized at the top to a maximum of 1. Control variables are winsorized at the top and bottom 1\%. Table \ref{table_variable_definitions} in Appendix provides a detailed list of variable definitions. *, ** and *** denote the statistical significance at the 10\%, 5\% and 1\% level, respectively. Sample period: 1997-2010. Sources: CRSP, COMPUSTAT, 13F and IBES.} 
  \label{table_h2_iv} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{9}{c}{\textit{Dependent variable:}} \\ 
\cline{2-10} 
\\[-1.8ex] & \multicolumn{1}{c}{First stage} & \multicolumn{1}{c}{OLS} & \multicolumn{1}{c}{IV} & \multicolumn{1}{c}{OLS} & \multicolumn{1}{c}{IV} & \multicolumn{1}{c}{OLS} & \multicolumn{1}{c}{IV} & \multicolumn{1}{c}{OLS} & \multicolumn{1}{c}{IV} \\ 
\cline{3-10} 
\\[-1.8ex] & VCV\textsubscript{USD} & \multicolumn{2}{c}{FOR\_OWN} & \multicolumn{2}{c}{FOR\_BREADTH} & \multicolumn{2}{c}{FOR\_TO\_INST\_OWN} & \multicolumn{2}{c}{FOR\_TO\_INST\_BREADTH} \\ 
\\[-1.8ex] & (1) & (2) & (3) & (4) & (5) & (6) & (7) & (8) & (9) \\ 
\hline \\[-1.8ex] 
\multicolumn{10}{@{} l}{\textit{Panel A: Volume coefficient variation (\textit{VCV\textsubscript{USD}}) as information asymmetry measure}}
\\
\\
  VCV\textsubscript{USD}  &  & $-$0.020$^{***}$ & $-$0.076$^{*}$ & $-$0.007$^{***}$ & $-$0.018$^{***}$ & $-$0.009 & $-$0.037 & 0.011$^{*}$ & $-$0.012 \\ 
  &  & (0.006) & (0.041) & (0.001) & (0.005) & (0.009) & (0.050) & (0.006) & (0.051) \\ 
 AFTER & $-$0.039$^{***}$ &  &  &  &  &  &  &  &  \\ 
  & (0.005) &  &  &  &  &  &  &  &  \\ 
  TREATED & $-$0.074$^{***}$ &  &  &  &  &  &  &  &  \\ 
  & (0.016) &  &  &  &  &  &  &  &  \\ 
  AFTER\_TREATED & 0.035$^{***}$ &  &  &  &  &  &  &  &  \\ 
  & (0.007) &  &  &  &  &  &  &  &  \\ 
  BM\_RATIO & 0.147$^{***}$ & $-$0.0002 & 0.007 & $-$0.001$^{***}$ & 0.001 & $-$0.002 & 0.002 & 0.0003 & 0.003 \\ 
  & (0.021) & (0.003) & (0.007) & (0.0001) & (0.001) & (0.002) & (0.007) & (0.001) & (0.007) \\ 
  LEVERAGE & $-$0.075$^{*}$ & 0.005 & 0.0003 & 0.002$^{***}$ & 0.001$^{**}$ & $-$0.009 & $-$0.012$^{*}$ & $-$0.001 & $-$0.003 \\ 
  & (0.043) & (0.005) & (0.003) & (0.001) & (0.001) & (0.007) & (0.007) & (0.004) & (0.005) \\ 
  ROA & $-$1.183$^{***}$ & 0.083$^{***}$ & 0.016 & 0.010$^{***}$ & $-$0.004 & $-$0.044$^{**}$ & $-$0.077 & $-$0.051$^{***}$ & $-$0.079 \\ 
  & (0.248) & (0.017) & (0.034) & (0.003) & (0.005) & (0.017) & (0.052) & (0.014) & (0.057) \\  
 \hline \\[-1.8ex] 
Industry fixed effects & Yes & Yes & Yes & Yes & Yes & Yes & Yes & Yes & Yes \\ 
Year fixed effects & Yes & Yes & Yes & Yes & Yes & Yes & Yes & Yes & Yes \\ 
Treated firm obs. & 5,298 & 5,298 & 5,298 & 5,298 & 5,298 & 5,298 & 5,298 & 5,298 & 5,298 \\ 
Control firm obs. & 15,836 & 15,836 & 15,836 & 15,836 & 15,836 & 15,836 & 15,836 & 15,836 & 15,836 \\ 
Distinct treated firms & 1,610 & 1,610 & 1,610 & 1,610 & 1,610 & 1,610 & 1,610 & 1,610 & 1,610 \\ 
Distinct control firms & 3,435 & 3,435 & 3,435 & 3,435 & 3,435 & 3,435 & 3,435 & 3,435 & 3,435 \\ 
Observations & 21,134 & 21,134 & 21,134 & 21,134 & 21,134 & 21,134 & 21,134 & 21,134 & 21,134 \\ 
First-stage F-statistic & 22.304 \\
Adjusted R$^{2}$ & 0.246 & 0.224 &  & 0.459 &  & 0.158 &  & 0.222 &  \\ 
\hline \\[-1.8ex]
\\[-1.8ex] & \multicolumn{1}{c}{First stage} & \multicolumn{1}{c}{OLS} & \multicolumn{1}{c}{IV} & \multicolumn{1}{c}{OLS} & \multicolumn{1}{c}{IV} & \multicolumn{1}{c}{OLS} & \multicolumn{1}{c}{IV} & \multicolumn{1}{c}{OLS} & \multicolumn{1}{c}{IV} \\ 
\cline{3-10} 
\\[-1.8ex] & BA\_SPREAD & \multicolumn{2}{c}{FOR\_OWN} & \multicolumn{2}{c}{FOR\_BREADTH} & \multicolumn{2}{c}{FOR\_TO\_INST\_OWN} & \multicolumn{2}{c}{FOR\_TO\_INST\_BREADTH} \\ 
\\[-1.8ex] & (1) & (2) & (3) & (4) & (5) & (6) & (7) & (8) & (9) \\ 
\hline \\[-1.8ex] 
\multicolumn{10}{@{} l}{\textit{Panel B: Bid-ask spread (\textit{BA\_SPREAD}) as information asymmetry measure}}
\\
\\
BA\_SPREAD &  & $-$0.213$^{***}$ & 2.516 & $-$0.042$^{***}$ & $-$0.939 & $-$0.146$^{**}$ & 4.820 & $-$0.033 & 2.844 \\ 
  &  & (0.051) & (1.990) & (0.012) & (1.199) & (0.064) & (5.588) & (0.046) & (4.013) \\  
 AFTER & 0.001 &  &  &  &  &  &  &  &  \\ 
  & (0.003) &  &  &  &  &  &  &  &  \\ 
  TREATED & $-$0.0004 &  &  &  &  &  &  &  &  \\ 
  & (0.001) &  &  &  &  &  &  &  &  \\ 
  AFTER\_TREATED & $-$0.001 &  &  &  &  &  &  &  &  \\ 
  & (0.001) &  &  &  &  &  &  &  &  \\ 
  BM\_RATIO & 0.009$^{***}$ & $-$0.001 & $-$0.025 & $-$0.001$^{***}$ & 0.006 & $-$0.002 & $-$0.045 & 0.002$^{**}$ & $-$0.023 \\ 
  & (0.001) & (0.003) & (0.019) & (0.0002) & (0.011) & (0.001) & (0.051) & (0.001) & (0.034) \\ 
  LEVERAGE & $-$0.005 & 0.006 & 0.019$^{*}$ & 0.003$^{***}$ & $-$0.002 & $-$0.009 & 0.015 & $-$0.002 & 0.012 \\ 
  & (0.004) & (0.005) & (0.011) & (0.001) & (0.003) & (0.007) & (0.020) & (0.004) & (0.018) \\ 
  ROA & $-$0.207$^{***}$ & 0.063$^{*}$ & 0.628 & 0.009$^{**}$ & $-$0.177 & $-$0.063$^{**}$ & 0.966 & $-$0.071$^{***}$ & 0.525 \\ 
  & (0.009) & (0.034) & (0.405) & (0.004) & (0.252) & (0.026) & (1.153) & (0.011) & (0.838) \\ 
 \hline \\[-1.8ex] 
Industry fixed effects & Yes & Yes & Yes & Yes & Yes & Yes & Yes & Yes & Yes \\ 
Year fixed effects & Yes & Yes & Yes & Yes & Yes & Yes & Yes & Yes & Yes \\ 
Treated firm obs. & 5,298 & 5,298 & 5,298 & 5,298 & 5,298 & 5,298 & 5,298 & 5,298 & 5,298 \\ 
Control firm obs. & 15,836 & 15,836 & 15,836 & 15,836 & 15,836 & 15,836 & 15,836 & 15,836 & 15,836 \\ 
Distinct treated firms & 1,610 & 1,610 & 1,610 & 1,610 & 1,610 & 1,610 & 1,610 & 1,610 & 1,610 \\ 
Distinct control firms & 3,435 & 3,435 & 3,435 & 3,435 & 3,435 & 3,435 & 3,435 & 3,435 & 3,435 \\ 
Observations & 21,134 & 21,134 & 21,134 & 21,134 & 21,134 & 21,134 & 21,134 & 21,134 & 21,134 \\ 
First-stage F-statistic & 2.107 \\
Adjusted R$^{2}$ & 0.644 & 0.212 & & 0.356 &  & 0.158 &  & 0.217 &  \\
\hline 
\hline \\[-1.8ex] 
\multicolumn{10}{r}{} \\ 
\end{longtable}
\end{landscape}
